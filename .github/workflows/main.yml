name: A workflow for my Hello World App

on: push

jobs:
  build:
    name: Hello world action
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Set up JDK 17
        uses: actions/setup-java@v4  # Updated to v4 for better performance and features
        with:
          java-version: '17'  # Changed from '11' to '17' to match POM target
          distribution: 'temurin'  # 'temurin' (Eclipse Temurin) is a good, free distribution; 'adopt' is deprecated

      - name: Cache Maven dependencies  # Optional: Speeds up builds by caching ~/.m2
        uses: actions/cache@v4
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: ${{ runner.os }}-m2

      - name: Unit Tests
        run: mvn -Dtest=com.napier.sem.MyTest test  # Note: Double-check if this should be 'com.napier.sem.AppTest' based on your POM's groupId

      - name: Package and Run docker compose
        run: |
          mvn package -DskipTests
          docker compose up --abort-on-container-exit